---
title: "assign_3_CF_AL_SA"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(tidyverse)
library(janitor)
library(ggplot2)
library(wesanderson)
library(dplyr)
```

```{r}
#readin Data
cost_gas_data<- read_csv("assign_3_data.csv") %>% 
  clean_names()
```

```{r}
# Linear Regression Low Cost Consumer 
lm_low <- lm(price_dollars ~ q_low_gallons, data=cost_gas_data) 
print(lm_low)  #  1.169e+01 + -6.611e-05*q
# Linear Regression High Cost Consumer
lm_high <- lm(price_dollars ~ q_high_gallons, data=cost_gas_data) 
print(lm_high)  #  1.580e+01 + -2.731e-05*q
# Linear Regression Aggregate Cost Consumer
lm_agg <- lm(price_dollars ~ q_aggregrate, data=cost_gas_data) 
print(lm_agg)  #  1.500e+01 + -2.043e-05*q

```
Aggregate daily demand curve for gasoline & supply curve
for gasoline

```{r}
I1<-  lm_low$coefficients[1] 
I2<-  lm_high$coefficients[1]
S1<-  lm_low$coefficients[2]
S2<-  lm_high$coefficients[2]
low_demand <<- function(q)  I1 + (S1*q)
high_demand <<- function(q) I2 + (S2*q)
agg_demand <- function(q) {
  
  demand_dom <<- function(q){
    if (I1==I2){0}
    else if(I1>I2){low_demand(q)}
    else if(I2>I1){high_demand(q)}
  }
  
  intersect_point <<- uniroot(function(q){high_demand(q)-low_demand(q)},interval = c(0,1),extendInt = "yes")
  
  ifelse(q<abs(intersect_point$root),demand_dom(q),lm_agg$coefficients[1] + (lm_agg$coefficients[2]*q))
}
supply <- function(q)  3 + (.0000*q)
local_env_cost<- function(q) 1.5 + (.0000*q) # local MEC $ 1.50
global_env_cost<- function(q) .50 + (.0000*q) # global MEC $.50
total_env_cost<- function(q) 2+ (.0000*q)# total MEC $.50

x<- 0:300 # define scale

```

```{r}
ggplot()+
  geom_point(data = cost_gas_data, aes(x= q_low_gallons, y = price_dollars))+
  stat_function(aes(x, color = "Low"), fun = low_demand)+ 
  geom_point(data = cost_gas_data, aes(x= q_high_gallons, y = price_dollars))+
  stat_function(aes(x, color = "high"), fun = high_demand)+
  geom_point(data = cost_gas_data, aes(x= q_aggregrate, y = price_dollars))+
  stat_function(aes(x, color = "Aggregrate"), fun = agg_demand)+
  stat_function(aes(x, color = "supply"), fun = supply)  +
  xlim(0,200000)+ 
  scale_y_continuous(breaks=c(0,3,6,9,12,15,18),limits = c(0,18))


```

What is the “benefit” to consumers under the status quo? What is
the “benefit” to producers under the status quo? 
```{r}
# find intersect of aggregate curve at P = $3.00 Q = 587482.43
agg_curve_intersect <- uniroot(function(q){agg_demand(q)-supply(q)},interval = c(0,1),extendInt = "yes")$root
  
```

What is the environmental cost
under the status quo (locally and in the rest of the world)?


```{r}
integrate(local_env_cost, 0, agg_curve_intersect)$value
integrate(global_env_cost, 0, agg_curve_intersect)$value
integrate(total_env_cost, 0, agg_curve_intersect)$value

```

---
2. How is the current consumer benefit divided between “High” and “Low” income
consumers?
