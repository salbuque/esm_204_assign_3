---
title: "assign_3_CF_AL_SA"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(tidyverse)
library(janitor)
library(ggplot2)
library(wesanderson)
library(dplyr)
```

```{r}
#readin Data
cost_gas_data<- read_csv("assign_3_data.csv") %>% 
  clean_names()
```

```{r}
# Linear Regression Low Cost Consumer 
lm_low <- lm(price_dollars ~ q_low_gallons, data=cost_gas_data) 
print(lm_low)  #  1.169e+01 + -6.611e-05*q
# Linear Regression High Cost Consumer
lm_high <- lm(price_dollars ~ q_high_gallons, data=cost_gas_data) 
print(lm_high)  #  1.580e+01 + -2.731e-05*q
# Linear Regression Aggregate Cost Consumer
lm_agg <- lm(price_dollars ~ q_aggregrate, data=cost_gas_data) 
print(lm_agg)  #  1.500e+01 + -2.043e-05*q

```


```{r}
I1<- 1.169e+01
I2<- 1.580e+01
S1<- -6.611e-05
S2<- -2.731e-05
low_demand <<- function(q) I1 + (S1*q)
high_demand <<- function(q) I2 + (S2*q)
supply <<- function(q)  3 + (.0000*q)

x<- 0:300 # define scale

```

```{r}

# Visualize 
#a data vs. estimate Low
ggplot()+
   geom_point(data = cost_gas_data, aes(x= q_low_gallons, y = price_dollars))+
  stat_function(aes(x, color = "Low"), fun = low_demand)+ 
  scale_y_continuous(0,6)

#a data vs. estimate high
ggplot()+
   geom_point(data = cost_gas_data, aes(x= q_high_gallons, y = price_dollars))+
  stat_function(aes(x, color = "high"), fun = high_demand)+
  stat_function(aes(x, color = "supply"), fun = supply)


```
```{r}
# aggregate Demand


gen_demand_curves <- function(I1,I2,S1,S2) {
  high_demand <<- function(q){I1+S1*q}
  low_demand <<- function(q){I2+S2*q}
  demand_dom <<- function(q){
    if (I1==I2){0}
    else if(I1>I2){low_demand(q)}
    else if(I2>I1){high_demand(q)}
  }
 
  intersect_point <<- uniroot(function(q){
    if (I1==I2){0}
    else if(I1>I2){b_demand(q)-I2}
    else if(I2>I1){s_demand(q)-I1}},
    interval = c(0,1),extendInt = "yes")
 
  demand_agg <<- function(q){
    ifelse(q<intersect_point$root,demand_dom(q),((S2*I1+S1*I2)/(S2+S1))+((S1*S2)/(S1+S2))*q)
    }
 
}


#a data vs. estimate agg
ggplot()+
   geom_point(data = cost_gas_data, aes(x= q_aggregrate, y = price_dollars))+
  stat_function(aes(x, color = "aggregate"), fun = demand_agg)+
  stat_function(aes(x, color = "supply"), fun = supply)
  
```

